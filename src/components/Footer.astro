---
import { getFooterItems } from "@config/navigation";
import { t } from "@locales";
import { buildLocalizedPath } from "@utils/routes";

interface Props {
  lang: string;
  currentPath?: string; // Current page path for active state
}

const { lang, currentPath = "" } = Astro.props;

// Get footer navigation items (excludes home, only shows items with content)
const footerItems = await getFooterItems(lang);

// Build items with URLs, labels, and active states
const itemsWithUrls = footerItems.map((item) => {
  let url: string;

  // Special case: stats is a sub-route of books
  if (item.routeKey === "stats") {
    url = buildLocalizedPath(lang, "books", "stats");
  } else if (item.routeKey === "home") {
    url = `/${lang}`;
  } else {
    url = buildLocalizedPath(lang, item.routeKey);
  }

  const isActive =
    item.matchStrategy === "exact" ? currentPath === url || currentPath === `${url}/` : currentPath.startsWith(url);

  return {
    url,
    label: t(lang, `pages.${item.id}`),
    id: item.id,
    isActive,
  };
});
---

<footer class="footer">
  <div class="footer__container">
    <!-- Navigation Links -->
    <nav class="footer__nav" aria-label={t(lang, "footer.navigation")}>
      <ul class="footer__links">
        {
          itemsWithUrls.map((item) => (
            <li class="footer__link-item">
              <a href={item.url} class:list={["footer__link", { "footer__link--active": item.isActive }]}>
                {item.label}
              </a>
            </li>
          ))
        }
      </ul>
    </nav>

    <!-- Tech Stack / Built With -->
    <div class="footer__meta">
      <p class="footer__built-with">
        {t(lang, "footer.builtWith")}
        <a href="https://astro.build" class="footer__tech-link" rel="noopener noreferrer" target="_blank">Astro</a>
      </p>
    </div>
  </div>
</footer>

<style lang="scss">
  @use "../styles/components/footer";
</style>
