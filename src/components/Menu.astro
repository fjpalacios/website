---
import LanguageSwitcher from "@components/LanguageSwitcher.astro";
import { t } from "@locales";
import { buildLocalizedPath } from "@utils/routes";

interface Props {
  lang: string;
  currentPath: string;
  translationSlug?: string; // Slug of the translated version
}

const { lang, currentPath, translationSlug } = Astro.props;

// Determine if translation exists
// Static pages (home, about, etc.) always have translation
// Detail pages depend on the i18n field (translationSlug)
// Listing pages (posts index, tutorials index, books index) don't have translation
const localizedPostsRoute = t(lang, "routes.posts");
const localizedTutorialsRoute = t(lang, "routes.tutorials");
const localizedBooksRoute = t(lang, "routes.books");
const localizedAboutRoute = t(lang, "routes.about");

const isStaticPage =
  !currentPath.includes(`/${localizedPostsRoute}/`) &&
  !currentPath.includes(`/${localizedTutorialsRoute}/`) &&
  !currentPath.includes(`/${localizedBooksRoute}/`);

const isListingPage =
  currentPath.endsWith(`/${localizedPostsRoute}`) ||
  currentPath.endsWith(`/${localizedTutorialsRoute}`) ||
  currentPath.endsWith(`/${localizedBooksRoute}`);

const hasTranslation = isStaticPage && !isListingPage ? true : translationSlug !== undefined;

const homeUrl = `/${lang}`;
const aboutUrl = buildLocalizedPath(lang, "about");
const postsUrl = buildLocalizedPath(lang, "posts");
---

<nav class="menu">
  <div class="menu__left">
    <LanguageSwitcher lang={lang} translationSlug={translationSlug} disabled={!hasTranslation} />
    <button
      type="button"
      class="theme-switcher"
      id="theme-toggle"
      aria-label={t(lang, "menu.switchTheme")}
      title={t(lang, "menu.switchTheme")}
    >
      <span class="theme-switcher__icon" aria-hidden="true"></span>
    </button>
  </div>
  <div class="menu__right">
    <ul class="navigation">
      <li class="navigation__link">
        <a
          href={homeUrl}
          class:list={[{ "navigation__link--active": currentPath === homeUrl || currentPath === `${homeUrl}/` }]}
        >
          {t(lang, "pages.home")}
        </a>
      </li>
      <li class="navigation__link">
        <a
          href={aboutUrl}
          class:list={[{ "navigation__link--active": currentPath === aboutUrl || currentPath === `${aboutUrl}/` }]}
        >
          {t(lang, "pages.about")}
        </a>
      </li>
      <li class="navigation__link">
        <a href={postsUrl} class:list={[{ "navigation__link--active": currentPath.startsWith(postsUrl) }]}>
          {t(lang, "pages.posts")}
        </a>
      </li>
    </ul>
  </div>
</nav>

<script>
  import { initTheme } from "@scripts/theme";

  // Initialize theme on page load and after view transitions
  document.addEventListener("astro:page-load", () => {
    initTheme();
  });
</script>
