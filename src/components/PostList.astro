---
import PostTitle from "@components/PostTitle.astro";
import { buildBookUrl, buildTutorialUrl, buildPostUrl } from "@utils/routes";

import type { PostSummary, TutorialSummary, BookSummary } from "@/utils/blog";

// Generic item type that works for posts, tutorials, and books
type ListItem = PostSummary | TutorialSummary | BookSummary;

interface Props {
  posts: ListItem[];
  lang: "es" | "en";
}

const { posts, lang } = Astro.props;

// Default cover image fallback
const defaultCover = "/images/defaults/post-default.jpg";

// Get the correct URL path based on the item type and language
function getItemUrl(item: ListItem): string {
  const itemLang = item.language;

  switch (item.type) {
    case "book":
      return buildBookUrl(itemLang, item.slug);
    case "tutorial":
      return buildTutorialUrl(itemLang, item.slug);
    case "post":
    default:
      return buildPostUrl(itemLang, item.slug);
  }
}
---

<main class="blog">
  <section class="blog__grid">
    {
      posts.map((post) => (
        <a href={getItemUrl(post)}>
          <section class="blog__grid__post">
            <img src={post.cover || defaultCover} alt={post.title} width="800" height="400" loading="lazy" />
            <PostTitle title={post.title} date={post.date} lang={lang} />
            <div class="text-area">
              <p>{post.excerpt}</p>
            </div>
          </section>
        </a>
      ))
    }
  </section>
</main>
