---
/**
 * BookLink Component
 * Creates internal links to book reviews within MDX content
 *
 * Usage in MDX:
 * <BookLink title="Apocalipsis, de Stephen King" />
 * <BookLink title="Apocalipsis, de Stephen King" full={true} />
 *
 * Props:
 * - title: Book title (can be partial, e.g., "Apocalipsis" or "Apocalipsis, de Stephen King")
 * - full: Display full title with author (default: false)
 * - lang: Language to search in ("es" | "en", default: "es")
 */

import { findBook, generateDisplayTitle, generateBookUrl } from "@utils/bookLinkHelpers";
import { getCollection } from "astro:content";

interface Props {
  title: string;
  full?: boolean;
  lang?: "es" | "en";
}

const { title, full = false, lang = "es" } = Astro.props;

// Query all books and find the matching one
const allBooks = await getCollection("books");
const book = findBook(allBooks, title, lang);

// Generate display text and URL
const displayTitle = generateDisplayTitle(title, full, book);
const bookUrl = generateBookUrl(book, lang);
---

{bookUrl ? <a href={bookUrl} set:html={displayTitle} /> : <Fragment set:html={displayTitle} />}
