---
/**
 * YouTubeEmbed Component — Façade Pattern
 *
 * Renders a thumbnail + play button instead of loading the iframe directly.
 * The iframe (with autoplay) is injected only when the user clicks play,
 * avoiding an upfront request to youtube.com that penalizes LCP and CLS.
 */
import "@styles/components/youtube-embed.scss";

interface Props {
  id: string;
  title?: string;
}

const { id, title = "YouTube video" } = Astro.props;

const thumbnailUrl = `https://i.ytimg.com/vi/${id}/hqdefault.jpg`;
const embedUrl = `https://www.youtube.com/embed/${id}?autoplay=1`;
---

<div class="youtube-embed" data-embed-url={embedUrl}>
  <img src={thumbnailUrl} alt={title} class="youtube-embed__thumbnail" loading="lazy" width="480" height="360" />
  <button class="youtube-embed__play" type="button" aria-label={`Play: ${title}`}>
    <svg
      class="youtube-embed__play__icon"
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 68 48"
      width="68"
      height="48"
      aria-hidden="true"
      focusable="false"
    >
      <path
        class="youtube-embed__play__bg"
        d="M66.52 7.74c-.78-2.93-2.49-5.41-5.42-6.19C55.79.13 34 0 34 0S12.21.13 6.9 1.55c-2.93.78-4.63 3.26-5.42 6.19C.06 13.05 0 24 0 24s.06 10.95 1.48 16.26c.78 2.93 2.49 5.41 5.42 6.19C12.21 47.87 34 48 34 48s21.79-.13 27.1-1.55c2.93-.78 4.64-3.26 5.42-6.19C67.94 34.95 68 24 68 24s-.06-10.95-1.48-16.26z"
      ></path>
      <path class="youtube-embed__play__arrow" d="M45 24 27 14v20"></path>
    </svg>
  </button>
</div>

<script>
  // Replace façade content with actual iframe on play button click.
  // The wrapper div is kept so its CSS (aspect-ratio, border-radius…) stays intact.
  // iframe border is handled via CSS class — the frameborder HTML attribute is deprecated.
  document.querySelectorAll<HTMLElement>(".youtube-embed").forEach((wrapper) => {
    const button = wrapper.querySelector<HTMLButtonElement>(".youtube-embed__play");

    button?.addEventListener(
      "click",
      () => {
        const embedUrl = wrapper.dataset.embedUrl;
        if (!embedUrl) return;

        const iframe = document.createElement("iframe");
        iframe.src = embedUrl;
        iframe.title = button.getAttribute("aria-label") ?? "YouTube video";
        iframe.allow =
          "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share";
        iframe.allowFullscreen = true;
        iframe.setAttribute("referrerpolicy", "strict-origin-when-cross-origin");
        // border: 0 is set via CSS on youtube-embed__iframe — no deprecated HTML attributes
        iframe.className = "youtube-embed__iframe";

        wrapper.innerHTML = "";
        wrapper.appendChild(iframe);
      },
      { once: true },
    );
  });
</script>
