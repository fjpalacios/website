---
import PostTitle from "@components/PostTitle.astro";
import Share from "@components/Share.astro";
import Layout from "@layouts/Layout.astro";
import { t } from "@locales";
import { getCollection, render } from "astro:content";

import contactEn from "@/content/static/contact/en.json";
import contactEs from "@/content/static/contact/es.json";

export async function getStaticPaths() {
  const posts = await getCollection("posts");

  return posts.map((post) => ({
    params: { slug: post.data.post_slug },
    props: { postEntry: post },
  }));
}

const { postEntry } = Astro.props;
const post = postEntry.data;
const { Content } = await render(postEntry);

const lang = post.language;
const contact = lang === "es" ? contactEs : contactEn;

// Cover image with fallback
const coverImage = post.cover || `/images/defaults/post-default.jpg`;

// Share component data
const baseUrl = t(lang, "metaData.url");
const currentUrl = new URL(Astro.url.pathname, baseUrl).href;
const twitterUsername = t(lang, "metaData.twitterUsername");
---

<Layout lang={lang} title={post.title} description={post.excerpt} contact={contact}>
  <main class="post">
    <section class="post__content">
      <img src={coverImage} alt={post.title} width="1400" height="700" loading="lazy" />
      <PostTitle title={post.title} date={post.date} />
      <div class="text-area">
        <Content />
      </div>
    </section>
    <section class="post__info">
      <div class="post__info__icon">
        <i class="icon-tag"></i>
      </div>
      <ul class="post__info__text">
        <li>
          <a href={`/category/${post.category}`} class="post__info__text__item" title="Category">
            {post.category}
          </a>
        </li>
      </ul>
    </section>
  </main>
  <Share title={post.title} url={currentUrl} lang={lang} twitterUsername={twitterUsername} />
</Layout>
