---
import SeriesList from "@components/SeriesList.astro";
import Title from "@components/Title.astro";
import Layout from "@layouts/Layout.astro";
import { t } from "@locales";
import { getCollection } from "astro:content";

import contactEn from "@/content/static/contact/en.json";

const lang = "en";

// Get all series in English
const allSeries = await getCollection("series");
const englishSeries = allSeries.filter((serie) => serie.data.language === lang);

// Get all books in English to count items per serie
const allBooks = await getCollection("books");
const englishBooks = allBooks.filter((book) => book.data.language === lang);

// Count books per serie
const seriesWithCount = englishSeries.map((serie) => {
  const count = englishBooks.filter((book) => book.data.serie === serie.data.serie_slug).length;
  return { serie, count };
});

// Sort by name
seriesWithCount.sort((a, b) => a.serie.data.name.localeCompare(b.serie.data.name));

const pageTitle = `ðŸ“š ${t(lang, "pages.series")}`;
const pageDescription = t(lang, "allSeries");
---

<Layout lang={lang} title={pageTitle} description={pageDescription} contact={contactEn} translationSlug="">
  <Title title={pageTitle} />

  <SeriesList series={seriesWithCount} title={t(lang, "allSeries")} lang={lang} showCount={true} />
</Layout>
