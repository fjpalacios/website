---
import Paginator from "@components/Paginator.astro";
import PostList from "@components/PostList.astro";
import Title from "@components/Title.astro";
import Layout from "@layouts/Layout.astro";
import { t } from "@locales";

import contactEn from "@/content/static/contact/en.json";
import { paginateItems, getPageCount } from "@/utils/blog";
import { generateItemListSchema } from "@/utils/schemas/itemList";
import { getAllTutorialsForLanguage, TUTORIALS_PER_PAGE } from "@/utils/tutorialsPages";

const lang = "en";
const currentPage = 1;
const sortedTutorials = await getAllTutorialsForLanguage(lang);
const totalPages = getPageCount(sortedTutorials.length, TUTORIALS_PER_PAGE);
const tutorials = paginateItems(sortedTutorials, currentPage, TUTORIALS_PER_PAGE);

// Check if alternate language version has content (for language switcher)
const targetLang = "es";
const targetTutorials = await getAllTutorialsForLanguage(targetLang);
const hasTargetContent = targetTutorials.length > 0;

const pageTitle = "ðŸ“š " + t(lang, "pages.tutorials");
const pageDescription = "Web development tutorials and guides";

// Generate ItemList schema for SEO
const itemListSchema = generateItemListSchema(
  tutorials.map((tutorial) => ({
    name: tutorial.title,
    url: `/${lang}/${t(lang, "routes.tutorials")}/${tutorial.slug}/`,
    type: "TechArticle",
    description: tutorial.excerpt,
  })),
  Astro.site ? Astro.site.toString() : "https://fjp.es",
);
---

<Layout
  lang={lang}
  title={pageTitle}
  description={pageDescription}
  contact={contactEn}
  hasTargetContent={hasTargetContent}
>
  <script type="application/ld+json" set:html={JSON.stringify(itemListSchema)} />

  <Title title={pageTitle} />

  {
    tutorials.length > 0 ? (
      <PostList posts={tutorials} lang={lang} />
    ) : (
      <div class="empty-state">
        <p>{t(lang, "emptyState.tutorials")}</p>
      </div>
    )
  }

  <Paginator currentPage={currentPage} totalPages={totalPages} basePath="/en/tutorials" lang={lang} />
</Layout>

<style lang="scss">
  @use "@/styles/mixins" as *;
  @use "@/styles/variables" as *;

  .empty-state {
    grid-column: span 12;
    text-align: center;
    padding: 4rem 2rem;
    color: $cursive-color;
  }
</style>
