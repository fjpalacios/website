---
import CourseList from "@components/CourseList.astro";
import Title from "@components/Title.astro";
import Layout from "@layouts/Layout.astro";
import { t } from "@locales";
import { getCollection } from "astro:content";

import contactEs from "@/content/static/contact/es.json";

const lang = "es";

// Get all courses in Spanish
const allCourses = await getCollection("courses");
const spanishCourses = allCourses.filter((course) => course.data.language === lang);

// Check if target language (English) has courses
const targetLang = "en";
const targetCourses = allCourses.filter((course) => course.data.language === targetLang);
const hasTargetContent = targetCourses.length > 0;

// For now, courses don't have related content, so count is always 1
// In the future, this could count lessons or modules
const coursesWithCount = spanishCourses.map((course) => {
  return { course, count: 1 };
});

// Sort by name
coursesWithCount.sort((a, b) => a.course.data.name.localeCompare(b.course.data.name));

const pageTitle = `ðŸŽ“ ${t(lang, "pages.courses")}`;
const pageDescription = t(lang, "allCourses");
---

<Layout
  lang={lang}
  title={pageTitle}
  description={pageDescription}
  contact={contactEs}
  hasTargetContent={hasTargetContent}
>
  <Title title={pageTitle} />

  {
    spanishCourses.length > 0 ? (
      <CourseList courses={coursesWithCount} title={t(lang, "allCourses")} lang={lang} showCount={false} />
    ) : (
      <div class="empty-state">
        <p>{t(lang, "emptyState.courses")}</p>
      </div>
    )
  }
</Layout>

<style lang="scss">
  @use "@/styles/variables" as *;

  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    color: $cursive-color;
  }
</style>
