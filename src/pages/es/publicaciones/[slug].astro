---
import PostTitle from "@components/PostTitle.astro";
import Share from "@components/Share.astro";
import Layout from "@layouts/Layout.astro";
import { t } from "@locales";
import { render } from "astro:content";
import { buildCategoryUrl, buildTagUrl } from "@utils/routes";
import contactEs from "@/content/static/contact/es.json";
import { generatePostDetailPaths } from "@/utils/postsPages";

export async function getStaticPaths() {
  const paths = await generatePostDetailPaths("es", contactEs);
  return paths.map(({ slug, props }) => ({
    params: { slug },
    props,
  }));
}

const { postEntry, lang, contact } = Astro.props;
const post = postEntry.data;
const { Content } = await render(postEntry);

// Cover image with fallback
const coverImage = post.cover || `/images/defaults/post-default.jpg`;

// Share component data
const baseUrl = t(lang, "metaData.url");
const currentUrl = new URL(Astro.url.pathname, baseUrl).href;
const twitterUsername = t(lang, "metaData.twitterUsername");
---

<Layout lang={lang} title={post.title} description={post.excerpt} contact={contact} translationSlug={post.i18n}>
  <main class="post">
    <section class="post__content">
      <div class="cover-image-wrapper">
        <img src={coverImage} alt={post.title} loading="lazy" />
      </div>
      <PostTitle title={post.title} date={post.date} lang={lang} />
      <div class="text-area">
        <Content />
      </div>
    </section>
    <section class="post__info">
      <div class="post__info__icon">üè∑Ô∏è</div>
      <ul class="post__info__text">
        <li>
          <a href={buildCategoryUrl(lang, post.category)} class="post__info__text__item" title="Category">
            {post.category}
          </a>
        </li>
      </ul>
    </section>
    {
      post.tags && post.tags.length > 0 && (
        <section class="post__info">
          <div class="post__info__icon">üîñ</div>
          <ul class="post__info__text">
            {post.tags.map((tag) => (
              <li>
                <a href={buildTagUrl(lang, tag)} class="post__info__text__item" title="Tag">
                  {tag}
                </a>
              </li>
            ))}
          </ul>
        </section>
      )
    }
  </main>
  <Share title={post.title} url={currentUrl} lang={lang} twitterUsername={twitterUsername} />
</Layout>
