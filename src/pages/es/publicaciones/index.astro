---
import PostList from "@components/PostList.astro";
import Title from "@components/Title.astro";
import Layout from "@layouts/Layout.astro";
import { t } from "@locales";
import { buildPostsIndexUrl } from "@utils/routes";
import contactEs from "@/content/static/contact/es.json";
import { getAllContentForLanguage, POSTS_PER_PAGE } from "@/utils/postsPages";
import { paginateItems, getPageCount } from "@/utils/blog";

const lang = "es";
const currentPage = 1;
const sortedContent = await getAllContentForLanguage(lang);
const totalPages = getPageCount(sortedContent.length, POSTS_PER_PAGE);
const posts = paginateItems(sortedContent, currentPage, POSTS_PER_PAGE);

// Check if alternate language version has content (for language switcher)
const targetLang = "en";
const targetContent = await getAllContentForLanguage(targetLang);
const hasTargetContent = targetContent.length > 0;

const pageTitle = "üìù " + t(lang, "pages.posts");
const pageDescription = "Art√≠culos, tutoriales y rese√±as de libros";
const baseUrl = buildPostsIndexUrl(lang);
---

<Layout lang={lang} title={pageTitle} description={pageDescription} contact={contactEs} hasTargetContent={hasTargetContent}>
  <Title title={pageTitle} />

  {
    posts.length > 0 ? (
      <PostList posts={posts} lang={lang} />
    ) : (
      <div class="empty-state">
        <p>{t(lang, "emptyState.posts")}</p>
      </div>
    )
  }

  {
    totalPages > 1 && (
      <div class="pagination-info">
        <p>
          {t(lang, "pagination.page")} {currentPage} {t(lang, "pagination.of")} {totalPages} ‚Ä¢{" "}
          <a href={buildPostsIndexUrl(lang, 2)}>{t(lang, "pagination.next")}</a>
        </p>
      </div>
    )
  }
</Layout>
