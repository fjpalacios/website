---
import ChallengeList from "@components/ChallengeList.astro";
import Title from "@components/Title.astro";
import Layout from "@layouts/Layout.astro";
import { t } from "@locales";

import contactEs from "@/content/static/contact/es.json";
import { TAXONOMY_CONFIGS, getTaxonomyItemsWithCount, hasTargetContent } from "@/utils/taxonomyPages";

const lang = "es";
const config = TAXONOMY_CONFIGS.challenges;

const itemsData = await getTaxonomyItemsWithCount(config, lang);
const itemsWithContent = itemsData
  .filter(({ count }) => count > 0)
  .sort((a, b) => a.item.data.name.localeCompare(b.item.data.name))
  .map(({ item, count }) => ({ challenge: item, count }));

const hasTargetLangContent = await hasTargetContent(config, "en");
const pageTitle = `ðŸŽ¯ ${t(lang, "pages.challenges")}`;
const pageDescription = t(lang, "allChallenges");
---

<Layout
  lang={lang}
  title={pageTitle}
  description={pageDescription}
  contact={contactEs}
  hasTargetContent={hasTargetLangContent}
>
  <Title title={pageTitle} />

  {
    itemsWithContent.length > 0 ? (
      <ChallengeList challenges={itemsWithContent} title={t(lang, "allChallenges")} lang={lang} showCount={true} />
    ) : (
      <div class="empty-state">
        <p>{t(lang, "emptyState.challenges")}</p>
      </div>
    )
  }
</Layout>
